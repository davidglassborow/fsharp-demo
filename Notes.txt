        public ActionResult Index(string payment = "", int amount = 0, string cardType = "mastercard", string cardNumber = "1234-5678-1234-5678")
        {
            var validation = "";

            if(Request.HttpMethod == "POST")
            {
                if (amount >= 1)
                    validation = "Valid";
                else
                    validation = "We do not give refunds";

                if (payment == "cash")
                {
                    // nothing else to check
                }
                else if(payment == "creditcard")
                {
                    if (!(cardNumber == "1234-5678-1234-5678" && cardType == "visa"))
                        validation = "Invalid card type and number";
                }
                else
                {
                    throw new Exception($"Unknown payment type {payment}");
                }

            }

            return View(new HomeVM
            {
                Amount = amount,
                CardNumber = cardNumber,
                ValidationResult = validation
            });

            // Things we want to do:
            // - validate
            // - email to finance department
            // - post to a webservice
        }



		<h3>Validate payment</h3>
@if (!String.IsNullOrWhiteSpace(Model.ValidationResult))
{
    <div class="alert alert-warning">
        @Model.ValidationResult
    </div>
}
    <form method="post" class="f">
        <div class="form-group">
            <label for="amount">Amount</label><input id="amount" name="amount" type="number" value="@Model.Amount" class="form-control" />
        </div>
        <button type="submit" name="payment" value="cash">Post cash</button>
        <hr />
        <div class="form-group">
            <label for="cardNo">Card number</label><input id="cardNo" name="cardNo" type="text" maxlength="16" value="@Model.CardNumber" class="form-control" />
            <label for="cardType">Card type</label>
            <select id="cardType" name="cardType" class="form-control" >
                <option value="mastercard" selected="selected">Mastercard</option>
                <option value="visa">Visa</option>
            </select>
        </div>

        <button type="submit" name="payment" value="creditcard">Post credit card payment</button>

    </form>

	public class Email
	{
        public static void SendEmail(string toEmail, string body)
        {
            var fromEmail = "dave.glassborow@myemail.co.uk";
            using (var msg = new MailMessage(fromEmail, toEmail))
            {
                msg.Subject = "New Payment";
                msg.Body = body;
                using (var client = new SmtpClient("smtp.office365.com", 587))
                {
                    client.EnableSsl = true;
                    client.Credentials = new NetworkCredential(fromEmail, "*****");
                    client.Send(msg);
                }
            }
        }
	}


namespace Money

module Email = 
    open System.Net
    open System.Net.Mail

    /// Send email via office 365
    let sendTestEmail toEmail body =
        let fromEmail = "dave.glassborow@myemail.co.uk"
        use msg = new MailMessage(fromEmail,toEmail)
        msg.Subject <- "New Payment"
        msg.Body <- body 
        use client = new SmtpClient("smtp.office365.com",587)
        client.EnableSsl <- true  
        client.Credentials <- NetworkCredential(fromEmail,"****")
        client.Send(msg)
